{% extends "myapp/layout.html" %}
{% load humanize %}
{% block title %}
OrderList Admin
{% endblock %}

{% block content %}

<div id ="notifyupdate" class="alert alert-danger" style="display:none">
  <strong></strong> 
</div>
<div class="container mt-5">
  <h2 class="pb-1 border-bottom">All Order and Order Status (admin)</h2>
  <table class="table table-striped table-hover" id="tb_mycart" name="tb_mycart">
    <thead>
      <tr>
        <th scope="col">OrderId</th>
        <th scope="col">Total Quantity</th>
        <th scope="col">Total Price</th>
        <th scope="col">Order Time</th>
        <th scope="col">SLIP</th>
        <th scope="col">SLIP CHECKED</th>
        <th scope="col">PAID</th>
        <th scope="col">DELIVERY</th>
      </tr>
    </thead>
    <tbody>
      {% for orderitem in orderlists %}
      <tr>
        <td>{{orderitem.orderid}}</td>
        <td>{{orderitem.total|intcomma}}</td>
        <td>{{orderitem.quantity}}</td>
        <td>{{orderitem.stamp}}</td>
       
        <td>    
          {% if orderitem.slipuploadstatus%}
          <a href="../media/{{orderitem.image}}" target="_blank">
            <span class="text-success"><i class='fas fa-receipt' style='font-size:20px'></i></span>
          </a>
          {% else %}
           
            <span class="text-warning"><i class='fas fa-exclamation-triangle' style='font-size:20px'></i>pending</span>
           
          {% endif %}
        </td>

        <td>
          {% if orderitem.slipcheckedstatus %}
          <span class="text-success"><i class='fas fa-check-square' style='font-size:20px'></i></span>
          {% else %}
            <form id="frmCheckslip{{orderitem.orderid}}">
              {% csrf_token %}
              <span id="slipcheck" style="display:none" class="text-success"><i class='fas fa-check-square' style='font-size:20px'></i></span>
            <input type = "hidden" form="frmCheckslip{{orderitem.orderid}}" value="{{orderitem.orderid}}" id="orderid" name="orderid">  
            <input type = "hidden" form="frmCheckslip{{orderitem.orderid}}" value="slipchecked" id="updateWhat" name="updateWhat">  
            <button id='btn_checkslip' style="background-color:transparent;border:0px" class="btn-secondary btn-group-sm" onclick="doCheckslip($(this).closest('form'),$(this))">
              <span class="text-warning"><i class='fas fa-exclamation-triangle' style='font-size:20px'></i>update</span>
            </button>
            
            <form>
          {% endif %}
        </td>
        
        
        <td>
         
            {% if orderitem.paymentstatus %}
            <span class="text-success"><i class='fas fa-check-square' style='font-size:20px'></i></span>
            {% else %}
            <form id="frmCheckpayment{{orderitem.orderid}}">
              {% csrf_token %}
            <span id="paymentcheck" style="display:none" class="text-success"><i class='fas fa-check-square' style='font-size:20px'></i></span>
            <input type = "hidden" form="frmCheckpayment{{orderitem.orderid}}" value="{{orderitem.orderid}}" id="orderid" name="orderid">  
            <input type = "hidden" form="frmCheckpayment{{orderitem.orderid}}" value="paymentchecked" id="updateWhat" name="updateWhat">  
            <button id='btn_checkpayment' style="background-color:transparent;border:0px" class="btn-secondary btn-group-sm" onclick="doCheckpayment($(this).closest('form'),$(this))">
              <span class="text-warning"><i class='fas fa-exclamation-triangle' style='font-size:20px'></i>update</span>
            </button>
            
            <form>
              
            {% endif %}
        </td>
        
        <td>
          {% if orderitem.shippingstatus %}
          <span class="text-success"><i class='fas fas fa-truck' style='font-size:20px'></i></span>
          {% else %}
          <form id="frmCheckship{{orderitem.orderid}}">
            {% csrf_token %}
          <span id="shippingcheck" style="display:none" class="text-success"><i class='fas fa-check-square' style='font-size:20px'></i></span>
          <input type = "hidden" form="frmCheckship{{orderitem.orderid}}" value="{{orderitem.orderid}}" id="orderid" name="orderid">  
          <input type = "hidden" form="frmCheckship{{orderitem.orderid}}" value="deliverychecked" id="updateWhat" name="updateWhat">  
          <button id='btn_checkshipping' style="background-color:transparent;border:0px" class="btn-secondary btn-group-sm" onclick="doCheckship($(this).closest('form'),$(this))">
            <span class="text-warning"><i class='fas fa-exclamation-triangle' style='font-size:20px'></i>update</span>
          </button>
          
          <form>
            
          
          {% endif %}
        </td>
            
      </tr>
      
      {% endfor %}  
     
    </tbody>
  </table>
</div>
{% endblock %}

{% block javascript %}
  <script>
   
      function doCheckship(objform,objbutton)
      {  
           $(objform).on('submit', function(e){
                e.preventDefault();
                var formData = new FormData($(objform)[0]); 
                
                
                $.ajax({
                  type: 'POST',
                  url: "{% url 'allorderlist-page' %}",
                  data: formData,
                  async: false, 
                  cache: false, 
                  contentType: false, 
                  processData: false,  
                    success: function (response) {
                        var instance = JSON.parse(response["instance"]);
                        //var instance = JSON.parse(response["statusupdate"]);
                        console.log(response["instance"]["updatestatus"])
                        $("#notifyupdate").css('display','inline')
                        //$("#notifyupdate").html(instance["updatestatus"])
                        //$("#notifyupdate").html(`${instance}`)
                        
                        $(objform).find('span[id="shippingcheck"]').css('display','inline');
                        $(objbutton).css('display','none');
                    },
                    error: function (response) {
                        // alert the error if any error occured
                        alert(response["responseJSON"]["error"]);
                    }
                })
                
    
              })
                
      }

      function doCheckpayment(objform,objbutton)
      {  
           $(objform).on('submit', function(e){
                e.preventDefault();
                var formData = new FormData($(objform)[0]); 
                
                
                $.ajax({
                  type: 'POST',
                  url: "{% url 'allorderlist-page' %}",
                  data: formData,
                  async: false, 
                  cache: false, 
                  contentType: false, 
                  processData: false,  
                    success: function (response) {
                        var instance = JSON.parse(response["instance"]);
                        
                        $("#notifyupdate").css('display','inline')
                        $("#notifyupdate").html(`${instance["updatestatus"]}`)
                        $(objform).find('span[id="paymentcheck"]').css('display','inline');
                        $(objbutton).css('display','none');
                    },
                    error: function (response) {
                        // alert the error if any error occured
                        alert(response["responseJSON"]["error"]);
                    }
                })
                
    
              })
                
      }

  function doCheckslip(objform,objbutton)
  {  
       $(objform).on('submit', function(e){
            e.preventDefault();
            var formData = new FormData($(objform)[0]); 
            
            
            $.ajax({
              type: 'POST',
              url: "{% url 'allorderlist-page' %}",
              data: formData,
              async: false, 
              cache: false, 
              contentType: false, 
              processData: false,  
                success: function (response) {
                    var instance = JSON.parse(response["instance"]);
                    
                    $("#notifyupdate").css('display','inline')
                    $("#notifyupdate").html(`${instance["updatestatus"]}`)
                    $(objform).find('span[id="slipcheck"]').css('display','inline');
                    $(objbutton).css('display','none');
                    
                },
                error: function (response) {
                    // alert the error if any error occured
                    alert(response["responseJSON"]["error"]);
                }
            })
            

          })
            
  }
  </script>
{% endblock javascript%}
